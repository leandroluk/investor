---
title: Activate User
description: Activates a pending user account using email and OTP code.
---

import {MermaidZoom} from '#/components/molecules/MermaidZoom'

## Rules

- ðŸŒŽ Public endpoint.
- The user must exist in the system.
- The user must have status `PENDING` (not already active).
- The OTP code must be valid and not expired (15-minute TTL).
- After activation, user status changes to `ACTIVE`.
- A `UserActivatedEvent` is published to the message broker.

## Request

`PUT /auth/activate`

### Body

| Field | Type | Description |
| :--- | :--- | :--- |
| email | string | User's email address |
| otp | string | 6-digit OTP code received via email |

## Diagram

<MermaidZoom>
```mermaid
flowchart TD
    A["Client"] -- "PUT /auth/activate" --> B["API"]
    B --> C{"User exists?"}
    C -- "No" --> D["Return 404 Not Found"]
    D --> End([End])
    C -- "Yes" --> E{"Status is PENDING?"}
    E -- "No" --> F["Return 409 Conflict"]
    F --> End
    E -- "Yes" --> G{"OTP valid?"}
    G -- "No" --> H["Return 400 Bad Request"]
    H --> End
    G -- "Yes" --> I["Update user status to ACTIVE"]
    I --> J["Publish UserActivatedEvent"]
    J --> K["Return 200 OK"]
    K --> End
```
</MermaidZoom>

## Success Case

`200 OK`

## Error Cases

### User Not Found

`404 Not Found`

```json
{
  "correlationId": "uuid-v7",
  "code": "user.not_found",
  "message": "User not found.",
  "occurredAt": "2023-01-01T00:00:00.000Z"
}
```

### User Not Pending

`409 Conflict`

```json
{
  "code": "user.not_pending",
  "message": "User is not pending."
}
```

### Invalid OTP

`400 Bad Request`

```json
{
  "code": "user.invalid_otp",
  "message": "Invalid or expired OTP code."
}
```

### Validation Error

`400 Bad Request`

```json
{
  "code": "request.validation_error",
  "message": "OTP must be exactly 6 characters."
}
```
