---
title: Login using token
description: Authenticate user with a temporary token (e.g. from SSO)
---
import {MermaidZoom} from '#/components/molecules/MermaidZoom'

## Rules

- ðŸŒŽ Public endpoint.
- User provides a temporary encrypted token (typically from SSO callback).
- System validates and decrypts the token to extract user ID.
- System always creates access and refresh tokens.
- **2FA Flow**:
  - If 2FA is enabled, system emits `UserRequestChallengeEvent`.
  - The client must subsequently handle the challenge verification using the `ChallengeGuard` on protected routes.
- **Device Registration**:
  - Device is registered with `unknown` platform/brand if not already present.
- Logs the login attempt.

## Request

- Method: `POST`
- Path: `/auth/login/token`
- Body:
  - `token`: Encrypted temporary token (required, string)
  - `ip`: User's IP address (required, string)
  - `fingerprint`: Device fingerprint (required, string)

## Diagram

<MermaidZoom>
```mermaid
flowchart TD
  A["Client"] -- "POST /auth/login/token" --> B["API"]
  B --> C{"Valid Token?"}
  C -- "No" --> D["Return 401 Unauthorized"]
  C -- "Yes" --> E["Upsert Device (Unknown)"]
  E --> F["Create Tokens"]
  F --> G{"2FA Enabled?"}
  G -- "Yes" --> H["Publish UserRequestChallengeEvent"]
  H --> I["Return 200 OK (Tokens)"]
  G -- "No" --> I
```
</MermaidZoom>

## Success Case

- Status: `200 OK`
- Body:
```json
{
  "tokenType": "Bearer",
  "accessToken": "ey...",
  "refreshToken": "ey...",
  "expiresIn": 3600
}
```

## Error Case

- Status: `401 Unauthorized`
- Body:
```json
{
  "correlationId": "uuid-v7",
  "code": "user.invalid_credentials",
  "message": "Invalid or expired token",
  "occurredAt": "2023-01-01T00:00:00.000Z"
}
```
