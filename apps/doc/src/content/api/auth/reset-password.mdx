---
title: Reset Password
description: Set a new password using the OTP code
---

import { MermaidZoom } from '#/components/molecules/MermaidZoom'

## Rules

- üåé Public endpoint.
- User provides email, OTP, and new password.
- System validates OTP.
- System validates password complexity.
- Password is hashed and updated in the database.
- All existing sessions are invalidated.

## Request

`PUT /auth/recover`

### Body

| Field | Type | Description |
| :--- | :--- | :--- |
| email | string | User's email address |
| otp | string | 6-digit OTP code |
| password | string | New password |

## Diagram

<MermaidZoom>
```mermaid
flowchart TD
    A["Client"] -- "PUT /auth/recover" --> B["API"]
    B --> C{"User exists?"}
    C -- "No" --> D["Return 404 Not Found"]
    D --> End([End])
    C -- "Yes" --> E{"OTP valid?"}
    E -- "No" --> F["Return 400 Bad Request"]
    F --> End
    E -- "Yes" --> G{"Password complexity OK?"}
    G -- "No" --> H["Return 400 Bad Request"]
    H --> End
    G -- "Yes" --> I["Hash new password"]
    I --> J["Update password in database"]
    J --> K["Invalidate all active sessions"]
    K --> L["Publish PasswordResetEvent"]
    L --> M["Return 200 OK"]
    M --> End([End])
```
</MermaidZoom>

## Success Case

`200 OK`

## Error Cases

### Invalid OTP

`400 Bad Request`

### Weak Password

`400 Bad Request`

## Emitted Events

### UserPasswordResetEvent

**Tipo**: üìú **Audit√°vel** (`RESET_PASSWORD`)

> [!IMPORTANT]
> Este evento √© **automaticamente registrado** no audit log (`tb_activity`). Cada reset de senha gera um registro imut√°vel para compliance e investiga√ß√£o de seguran√ßa.

**Payload:**
```json
{
  "correlationId": "018f3b5e-1234-7000-8000-000000000000",
  "occurredAt": "2026-02-12T21:00:00.000Z",
  "payload": {
    "userId": "018f3b5e-5678-7000-8000-000000000001"
  }
}
```

### UserPasswordChangedEvent

**Tipo**: N√£o-Audit√°vel

Disparado para invalidar todas as sess√µes ativas do usu√°rio ap√≥s o reset.

**Payload:**
```json
{
  "correlationId": "018f3b5e-1234-7000-8000-000000000000",
  "occurredAt": "2026-02-12T21:00:00.000Z",
  "payload": {
    "userId": "018f3b5e-5678-7000-8000-000000000001"
  }
}
```
