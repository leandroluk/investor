---
title: Update User Profile
---
import { MermaidZoom } from '#/components/molecules/MermaidZoom'

## Rules

- **Authenticated Access**: Only authenticated users can update their profile.
- **Critical Fields**: Changing sensitive fields like email or wallet address is NOT allowed through this endpoint.
- **Sanitization**: Inputs (name, language) must be sanitized to prevent injection attacks and ensure data integrity.
- **Validation**:
    - `name`: Max 100 characters.
    - `language`: Must be a valid ISO 639-1 code (e.g., 'en', 'pt').
    - `timezone`: Must be a valid IANA Timezone string (e.g., 'America/Sao_Paulo').

## Request

- **Method**: `PATCH`
- **Path**: `/user/profile`
- **Body**:
    - `name` (optional): string
    - `language` (optional): string
    - `timezone` (optional): string

## Diagram

<MermaidZoom>
```mermaid
flowchart TD
    A["Client"] -- "PATCH /user/profile {name, language, ...}" --> B["API"]
    B --> C{"Is Authenticated?"}
    C -- "No" --> D["Return 401 Unauthorized"]
    C -- "Yes" --> E["Validate Input (Zod)"]
    E -- "Invalid" --> F["Return 400 Bad Request"]
    E -- "Valid" --> G["Update User Entity"]
    G --> H["Save to Database"]
    H --> I["Return 200 OK"]
```
</MermaidZoom>

## Success Case

- **Status**: `200 OK`
- **Body**:

```json
{
  "id": "018b7c86-8a9d-72c0-8339-2c7c5a5a7e3d",
  "name": "John Doe",
  "email": "john.doe@example.com",
  "status": "active",
  "twoFactorEnabled": true,
  "language": "en",
  "timezone": "America/New_York",
  "createdAt": "2024-01-01T10:00:00.000Z",
  "updatedAt": "2024-01-01T12:00:00.000Z"
}
```

## Error Case

- **Status**: `400 Bad Request`
- **Body**:

```json
{
  "correlationId": "uuid-v7",
  "code": "request.validation_error",
  "message": "Invalid language code",
  "occurredAt": "2023-01-01T00:00:00.000Z",
  "details": ["language must be a valid ISO 639-1 code"]
}
```

- **Status**: `401 Unauthorized`
- **Body**:

```json
{
  "correlationId": "uuid-v7",
  "code": "auth.unauthorized",
  "message": "Missing or invalid token",
  "occurredAt": "2023-01-01T00:00:00.000Z"
}
```

## Emitted Events

### User2FAToggledEvent _(Condicional)_

**Tipo**: üìú **Audit√°vel** (`TOGGLE_2FA`)

> [!IMPORTANT]
> Este evento √© emitido **APENAS se** o campo `twoFactorEnabled` for alterado. √â **automaticamente registrado** no audit log (`tb_activity`) para rastreabilidade de mudan√ßas de configura√ß√£o de seguran√ßa.

**Payload:**
```json
{
  "correlationId": "018f3b5e-1234-7000-8000-000000000000",
  "occurredAt": "2026-02-12T21:00:00.000Z",
  "payload": {
    "userId": "018f3b5e-5678-7000-8000-000000000001",
    "deviceId": "018f3b5e-9999-7000-8000-000000000003",
    "enabled": true,
    "previousState": false
  }
}
```
